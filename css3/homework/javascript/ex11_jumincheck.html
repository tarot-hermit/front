<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>주민번호 검사</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    'use strict';


    function juminCheck() {
      const j1 = document.getElementById("jumin1").value.trim();
      const j2 = document.getElementById("jumin2").value.trim();
      const jumin = j1 + j2;


      if (jumin.length !== 13 || isNaN(jumin)) {
        alert("주민번호 입력오류!!!");
        document.getElementById("jumin1").select();
        document.getElementById("jumin1").focus();
        return false;
      }


      const ok = validateJumin(jumin);

      if (ok) demo.innerHTML = `정상 주민번호 형식/검증 통과 : ${j1}-${j2}`;
      else demo.innerHTML = `검증 실패 : ${j1}-${j2}`;
    }


    function validateJumin(jumin) {


      const regEx = /^\d{6}[1-4]\d{6}$/;
      if (!regEx.test(jumin)) {
        alert("형식 오류 (7번째 자리는 1~4만 가능)");
        return false;
      }


      const yy = parseInt(jumin.substring(0, 2), 10);
      const mm = parseInt(jumin.substring(2, 4), 10);
      const dd = parseInt(jumin.substring(4, 6), 10);
      const genderCode = parseInt(jumin.charAt(6), 10);

      let fullYear;
      if (genderCode === 1 || genderCode === 2) fullYear = 1900 + yy;
      else if (genderCode === 3 || genderCode === 4) fullYear = 2000 + yy;


      const birth = new Date(fullYear, mm - 1, dd);
      if (
        birth.getFullYear() !== fullYear ||
        birth.getMonth() !== mm - 1 ||
        birth.getDate() !== dd
      ) {
        alert("존재하지 않는 생년월일입니다.");
        return false;
      }


      let hap = 0;
      const w = [2, 3, 4, 5, 6, 7, 8, 9, 2, 3, 4, 5];

      for (let i = 0; i < 12; i++) {
        hap += parseInt(jumin.charAt(i), 10) * w[i];
      }

      const checkDigit = (11 - (hap % 11)) % 10;

      if (checkDigit !== parseInt(jumin.charAt(12), 10)) {
        alert("주민번호가 유효하지 않습니다(체크섬 오류).");
        return false;
      }

      alert("정상 주민등록번호입니다.");
      return true;
    }

    function moveNext(obj, nextId) {
      if (obj.value.length >= obj.maxLength) {
        document.getElementById(nextId).focus();
      }
    }

    function jumin2Check(e) {

  
  e.target.value = e.target.value.replace(/\D/g, '');

  
  if (e.key === "Enter") {
    juminCheck();
  }

  
  
}

  </script>
</head>

<body>
  <p><br /></p>
  <div class="container">
    <h2 class="text-center">주민 번호 체크</h2>
    <form>
      <p>주민번호
        <input type="text" name="jumin1" id="jumin1" oninput="moveNext(this, 'jumin2')" maxlength="6" autofocus
          required />-
        <input type="password" name="jumin2" id="jumin2" oninput="jumin2Check(event)" maxlength="7" />
      </p>
      <p>
        <input type="button" value="주민번호체크" onclick="juminCheck()" class="btn btn-success" />
      </p>
    </form>
    <hr />
    <div id="demo"></div>
  </div>
</body>

</html>